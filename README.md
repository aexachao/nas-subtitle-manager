# NAS Subtitle Manager

> è‡ªåŠ¨åŒ–è§†é¢‘å­—å¹•æå–ä¸ç¿»è¯‘çš„ NAS ç®¡ç†å·¥å…·

ä¸€ä¸ªåŸºäº Whisper + LLM çš„æ™ºèƒ½å­—å¹•ç®¡ç†ç³»ç»Ÿï¼Œè‡ªåŠ¨æ‰«æ NAS åª’ä½“åº“ï¼Œæå–éŸ³è½¨ç”Ÿæˆå­—å¹•ï¼Œå¹¶æ”¯æŒå¤šè¯­è¨€ç¿»è¯‘ã€‚é€‚åˆå®¶åº­ NAS ç¯å¢ƒçš„è½»é‡çº§éƒ¨ç½²ã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

- **ğŸ¯ è‡ªåŠ¨åŒ–æµç¨‹** - æ‰«æåª’ä½“åº“ â†’ æå–å­—å¹• â†’ AI ç¿»è¯‘ï¼Œå…¨ç¨‹è‡ªåŠ¨åŒ–
- **ğŸŒ å¤šè¯­è¨€æ”¯æŒ** - Whisper æ”¯æŒ 99+ è¯­è¨€è¯†åˆ«ï¼ŒLLM ç¿»è¯‘æ”¯æŒä¸­è‹±æ—¥éŸ©ç­‰ä¸»æµè¯­è¨€
- **ğŸ¨ æš—è‰²ä¸»é¢˜ UI** - ç°ä»£åŒ– Web ç•Œé¢ï¼Œé€‚é…æš—è‰²ç¯å¢ƒ
- **ğŸ”Œ å¤š AI æä¾›å•†** - æ”¯æŒ Ollama (æœ¬åœ°)ã€DeepSeekã€Geminiã€OpenAI ç­‰
- **ğŸ“¦ ä¸€é”®éƒ¨ç½²** - Docker Compose éƒ¨ç½²ï¼Œæ— éœ€å¤æ‚é…ç½®
- **ğŸ“Š ä»»åŠ¡é˜Ÿåˆ—** - åå°å¼‚æ­¥å¤„ç†ï¼Œå®æ—¶è¿›åº¦ç›‘æ§

## ğŸ“¸ æˆªå›¾é¢„è§ˆ

```
![Dashboard](docs/images/dashboard.png)
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- Docker & Docker Compose
- NAS æˆ– Linux æœåŠ¡å™¨
- ï¼ˆå¯é€‰ï¼‰NVIDIA GPU + nvidia-dockerï¼ˆç”¨äºåŠ é€Ÿ Whisperï¼‰

### ä¸€é”®éƒ¨ç½²

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/your-username/nas-subtitle-manager.git
cd nas-subtitle-manager

# é…ç½®åª’ä½“è·¯å¾„
# ç¼–è¾‘ docker-compose.ymlï¼Œä¿®æ”¹ volumes æ˜ å°„
# - /your/media/path:/media  # ä½ çš„åª’ä½“åº“è·¯å¾„

# å¯åŠ¨æœåŠ¡
docker-compose up -d

# è®¿é—® Web ç•Œé¢
open http://localhost:8501
```

### ç›®å½•ç»“æ„

```
nas-subtitle-manager/
â”œâ”€â”€ app.py                 # ä¸»åº”ç”¨ç¨‹åº
â”œâ”€â”€ docker-compose.yml     # Docker ç¼–æ’é…ç½®
â”œâ”€â”€ Dockerfile            # å®¹å™¨æ„å»ºæ–‡ä»¶
â”œâ”€â”€ requirements.txt      # Python ä¾èµ–
â””â”€â”€ README.md
```

## ğŸ“– ä½¿ç”¨æŒ‡å—

### 1. é…ç½® Whisper æ¨¡å‹

**ä¾§è¾¹æ  â†’ Whisper è®¾ç½®**

- **æ¨¡å‹å¤§å°**: `tiny` (æœ€å¿«) â†’ `large-v3` (æœ€å‡†ç¡®)
- **è®¡ç®—ç±»å‹**: `int8` (çœå†…å­˜) / `float16` (æ›´ç²¾ç¡®)
- **è®¾å¤‡**: `cpu` / `cuda` (éœ€ GPU)
- **è§†é¢‘åŸå£°**: è‡ªåŠ¨æ£€æµ‹æˆ–æŒ‡å®šè¯­è¨€

### 2. é…ç½®ç¿»è¯‘æœåŠ¡

**ä¾§è¾¹æ  â†’ ç¿»è¯‘è®¾ç½®**

#### é€‰é¡¹ A: Ollama æœ¬åœ°æ¨¡å‹ï¼ˆæ¨èï¼‰

```bash
# å®‰è£… Ollama
curl -fsSL https://ollama.com/install.sh | sh

# æ‹‰å–æ¨¡å‹
ollama pull qwen2.5:7b
# æˆ–å…¶ä»–æ¨¡å‹: llama3.1, mistral, gemma2 ç­‰
```

é…ç½®ï¼š
- **AI æä¾›å•†**: Ollama (æœ¬åœ°æ¨¡å‹)
- **Base URL**: `http://ollama:11434/v1`
- **æ¨¡å‹**: ä»åˆ—è¡¨ä¸­é€‰æ‹©å·²å®‰è£…çš„æ¨¡å‹

#### é€‰é¡¹ B: äº‘æœåŠ¡ API

æ”¯æŒçš„æä¾›å•†ï¼š
- **DeepSeek** (å›½å†…æ¨èï¼Œæ€§ä»·æ¯”é«˜)
- **Google Gemini** (é€Ÿåº¦å¿«ï¼Œå…è´¹é¢åº¦)
- **Moonshot Kimi** (é•¿æ–‡æœ¬ä¼˜åŒ–)
- **é˜¿é‡Œé€šä¹‰åƒé—®** / **æ™ºè°± GLM**
- **OpenAI** (éœ€ç§‘å­¦ä¸Šç½‘)

é…ç½®ç¤ºä¾‹ï¼š
```
AI æä¾›å•†: DeepSeek (æ·±åº¦æ±‚ç´¢)
Base URL: https://api.deepseek.com
API Key: sk-xxxxxxxxxxxxx
æ¨¡å‹: deepseek-chat
```

### 3. æ‰«æä¸å¤„ç†

1. **åˆ·æ–°åª’ä½“åº“** - æ‰«æ `/media` ç›®å½•ä¸‹çš„æ‰€æœ‰è§†é¢‘
2. **ç­›é€‰æ–‡ä»¶** - å…¨éƒ¨ / æœ‰å­—å¹• / æ— å­—å¹•
3. **é€‰æ‹©æ–‡ä»¶** - å‹¾é€‰éœ€è¦å¤„ç†çš„è§†é¢‘
4. **å¼€å§‹å¤„ç†** - è‡ªåŠ¨æ’é˜Ÿå¤„ç†

### 4. ç›‘æ§ä»»åŠ¡

**ä»»åŠ¡é˜Ÿåˆ—** æ ‡ç­¾é¡µå®æ—¶æ˜¾ç¤ºï¼š
- ğŸ”µ ç­‰å¾…ä¸­ - é˜Ÿåˆ—ä¸­å¾…å¤„ç†
- ğŸŸ¡ å¤„ç†ä¸­ - Whisper æå–æˆ– LLM ç¿»è¯‘ä¸­
- ğŸŸ¢ å®Œæˆ - å­—å¹•å·²ç”Ÿæˆ
- ğŸ”´ å¤±è´¥ - å¯é‡è¯•æˆ–æŸ¥çœ‹é”™è¯¯æ—¥å¿—

## ğŸ› ï¸ é«˜çº§é…ç½®

### è‡ªå®šä¹‰åª’ä½“è·¯å¾„

ç¼–è¾‘ `docker-compose.yml`:

```yaml
services:
  app:
    volumes:
      - /path/to/your/movies:/media        # åª’ä½“åº“
      - /path/to/your/tv-shows:/media/tv   # å¯æŒ‚è½½å¤šä¸ªç›®å½•
      - ./data:/data                       # æ•°æ®æŒä¹…åŒ–
```

### GPU åŠ é€Ÿ

```yaml
services:
  app:
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
```

### å­—å¹•å‘½åè§„èŒƒ

è‡ªåŠ¨è¯†åˆ«ä»¥ä¸‹æ ¼å¼ï¼š

```
movie.srt              â†’ é»˜è®¤å­—å¹•ï¼ˆå†…å®¹æ£€æµ‹è¯­è¨€ï¼‰
movie.en.srt           â†’ è‹±è¯­å­—å¹•
movie.zh.srt           â†’ ä¸­æ–‡å­—å¹•
movie.ja.srt           â†’ æ—¥è¯­å­—å¹•
movie.chs.srt          â†’ ç®€ä½“ä¸­æ–‡
movie.cht.srt          â†’ ç¹ä½“ä¸­æ–‡
```

## ğŸ”§ æŠ€æœ¯æ ˆ

- **åç«¯**: Python 3.11 + Streamlit
- **å­—å¹•æå–**: [Faster-Whisper](https://github.com/SYSTRAN/faster-whisper) (OpenAI Whisper çš„ CTranslate2 ä¼˜åŒ–ç‰ˆ)
- **ç¿»è¯‘å¼•æ“**: OpenAI-compatible API (æ”¯æŒå¤šç§ LLM)
- **æ•°æ®åº“**: SQLite3 (è½»é‡çº§ï¼Œæ— éœ€é¢å¤–éƒ¨ç½²)
- **å®¹å™¨åŒ–**: Docker + Docker Compose

## ğŸ“Š æ€§èƒ½å‚è€ƒ

### Whisper æ¨¡å‹å¯¹æ¯”

| æ¨¡å‹ | é€Ÿåº¦ | ç²¾åº¦ | å†…å­˜ | é€‚ç”¨åœºæ™¯ |
|------|------|------|------|----------|
| tiny | âš¡âš¡âš¡âš¡âš¡ | â­â­ | 1GB | å¿«é€Ÿé¢„è§ˆ |
| base | âš¡âš¡âš¡âš¡ | â­â­â­ | 1GB | æ—¥å¸¸ä½¿ç”¨ |
| small | âš¡âš¡âš¡ | â­â­â­â­ | 2GB | æ¨è |
| medium | âš¡âš¡ | â­â­â­â­â­ | 5GB | é«˜è´¨é‡ |
| large-v3 | âš¡ | â­â­â­â­â­ | 10GB | ä¸“ä¸šçº§ |

### å¤„ç†æ—¶é—´ä¼°ç®—

- **1 å°æ—¶ç”µå½±** (base æ¨¡å‹ + CPU): ~10-15 åˆ†é’Ÿ
- **1 å°æ—¶ç”µå½±** (small æ¨¡å‹ + GPU): ~2-3 åˆ†é’Ÿ
- **ç¿»è¯‘æ—¶é—´**: ~2-5 åˆ†é’Ÿ (å–å†³äº API é€Ÿåº¦)

## ğŸ¤ å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆå­—å¹•è¯­è¨€è¯†åˆ«é”™è¯¯ï¼Ÿ

**A**: ä¼˜å…ˆçº§: æ–‡ä»¶åè¯­è¨€æ ‡è®° > å†…å®¹è‡ªåŠ¨æ£€æµ‹ã€‚å»ºè®®æ‰‹åŠ¨é‡å‘½åï¼š
```bash
# é”™è¯¯ï¼šmovie-C.srt (å¯èƒ½è¯¯åˆ¤)
# æ­£ç¡®ï¼šmovie.ja.srt (æ˜ç¡®æ ‡è®°æ—¥è¯­)
```

### Q: Ollama è¿æ¥å¤±è´¥ï¼Ÿ

**A**: æ£€æŸ¥å®¹å™¨ç½‘ç»œï¼š
```bash
docker exec -it nas-subtitle-manager ping ollama
# å¦‚æœå¤±è´¥ï¼Œæ£€æŸ¥ docker-compose.yml ä¸­çš„ networks é…ç½®
```

### Q: ç¿»è¯‘è´¨é‡ä¸å¥½ï¼Ÿ

**A**: å°è¯•ï¼š
1. æ›´æ¢æ¨¡å‹ï¼ˆå¦‚ `qwen2.5:14b` æ›¿ä»£ `7b`ï¼‰
2. è°ƒæ•´ç¿»è¯‘ promptï¼ˆç¼–è¾‘ `app.py` ä¸­çš„ `translate_subtitles` å‡½æ•°ï¼‰
3. ä½¿ç”¨ä»˜è´¹ API (DeepSeek, Claude, GPT-4)

### Q: æ”¯æŒè‡ªå®šä¹‰ç¿»è¯‘è§„åˆ™å—ï¼Ÿ

**A**: å¯ä»¥ã€‚ä¿®æ”¹ `translate_subtitles()` å‡½æ•°ä¸­çš„ promptï¼š
```python
prompt = f"""ä½ æ˜¯ä¸“ä¸šå­—å¹•ç¿»è¯‘ã€‚
è¦æ±‚ï¼š
1. ä¿æŒå°è¯å£è¯­åŒ–
2. äººå/åœ°åéŸ³è¯‘
3. ä¸“ä¸šæœ¯è¯­ä¿ç•™åŸæ–‡

{rebuild_srt(batch)}"""
```

## ğŸ—ºï¸ Roadmap

- [ ] æ”¯æŒ ASS/SSA é«˜çº§å­—å¹•æ ¼å¼
- [ ] å­—å¹•æ—¶é—´è½´æ ¡å‡†å·¥å…·
- [ ] æ‰¹é‡å¯¼å‡º/å¯¼å…¥é…ç½®
- [ ] å¤šç”¨æˆ·æƒé™ç®¡ç†
- [ ] Web API æ¥å£
- [ ] ç§»åŠ¨ç«¯ App

## ğŸ“„ å¼€æºåè®®

MIT License - è‡ªç”±ä½¿ç”¨ã€ä¿®æ”¹ã€åˆ†å‘

## ğŸ™ è‡´è°¢

- [OpenAI Whisper](https://github.com/openai/whisper) - è¯­éŸ³è¯†åˆ«æ¨¡å‹
- [Faster-Whisper](https://github.com/SYSTRAN/faster-whisper) - æ€§èƒ½ä¼˜åŒ–å®ç°
- [Streamlit](https://streamlit.io/) - Web ç•Œé¢æ¡†æ¶
- [Ollama](https://ollama.com/) - æœ¬åœ° LLM è¿è¡Œæ—¶

---

**â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ª Starï¼**

## ğŸ’¬ åé¦ˆä¸æ”¯æŒ

- ğŸ› [æŠ¥å‘Š Bug](https://github.com/your-username/nas-subtitle-manager/issues)
- ğŸ’¡ [åŠŸèƒ½å»ºè®®](https://github.com/your-username/nas-subtitle-manager/discussions)
- ğŸ“§ è”ç³»ä½œè€…: your-email@example.com
